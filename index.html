<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de Costos</title>

  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#f3dfe4">

  <!-- Cache-bust -->
  <link rel="stylesheet" href="style.css?v=20260208d" />
</head>
<body>

<!-- Sidebar overlay + drawer -->
<div id="drawerOverlay" class="drawerOverlay" aria-hidden="true"></div>

<aside id="drawer" class="drawer" aria-label="Recipes">
  <div class="drawerHeader">
    <p class="drawerTitle">Recetas</p>
    <button id="closeDrawerBtn" class="iconBtn" type="button" aria-label="Close">✕</button>
  </div>

  <div class="drawerBody">

    <!-- Search + Filters -->
    <div class="drawerCard">
      <div class="drawerCol">
        <label class="fieldLabel" for="recipeSearch">Buscar</label>
        <input id="recipeSearch" placeholder="Buscar receta…" />
      </div>

      <div class="drawerGrid2">
        <div class="drawerCol">
          <label class="fieldLabel" for="folderFilter">Carpeta</label>
          <select id="folderFilter" class="select">
            <option value="">Todas</option>
          </select>
        </div>

        <label class="check">
          <input id="favOnlyToggle" type="checkbox" />
          <span>Solo favoritas</span>
        </label>
      </div>

      <div class="smallNote">
        Tip: Usa carpeta + buscador + favoritas para ordenar rápido.
      </div>
    </div>

    <!-- Create recipe -->
    <div class="drawerCard">
      <div class="drawerRow">
        <input id="newRecipeName" placeholder="Nueva Receta (ej. Kuchen)" />
        <button id="createRecipeBtn" class="btn" type="button">Crear</button>
      </div>
      <div class="smallNote">Tip: Abre una receta, luego presiona <b>Guardar</b> para almacenar ingredientes.</div>
    </div>

    <!-- Current recipe actions -->
    <div class="drawerCard">
      <div class="drawerRow" style="justify-content:space-between; gap:10px;">
        <div class="pill">Receta actual</div>
        <div class="rowRight">
          <button id="toggleFavoriteBtn" class="iconBtn" type="button" title="Marcar como favorita">☆</button>
          <button id="saveRecipeBtn" class="btn" type="button">Guardar</button>
        </div>
      </div>

      <div class="drawerGrid2" style="margin-top:10px;">
        <div class="drawerCol">
          <label class="fieldLabel" for="currentFolderSelect">Carpeta</label>
          <select id="currentFolderSelect" class="select">
            <option value="">(Sin carpeta)</option>
          </select>
        </div>

        <div class="drawerCol">
          <label class="fieldLabel">&nbsp;</label>
          <button id="clearFolderBtn" class="btn btn-secondary" type="button">Quitar carpeta</button>
        </div>
      </div>

      <div id="recipeList" class="recipeList" role="list" style="margin-top:12px;"></div>
    </div>

    <!-- Folders management -->
    <div class="drawerCard">
      <div class="drawerRow">
        <input id="newFolderName" placeholder="Nueva carpeta (ej. Tortas)" />
        <button id="createFolderBtn" class="btn btn-secondary" type="button">Crear carpeta</button>
      </div>

      <div class="folderListHeader">
        <div class="pill">Carpetas</div>
        <button id="resetFiltersBtn" class="iconBtn" type="button" title="Limpiar filtros">Limpiar</button>
      </div>

      <div id="foldersList" class="foldersList"></div>
      <div class="smallNote">Eliminar carpeta no elimina recetas; solo las deja “sin carpeta”.</div>
    </div>

  </div>
</aside>

<header class="topbar">
  <div class="brand">
    <button id="openDrawerBtn" class="hamburger" type="button" aria-label="Open menu">☰</button>
    <div>
      <h1 id="recipeTitle">Calculadora de Costos</h1>
      <p class="sub">Ingrediente → Costo Unitario → Costo Receta</p>
    </div>
  </div>
  <div class="actions">
    <button id="addRowBtn" class="btn" type="button">+ Añadir</button>
    <button id="resetBtn" class="btn btn-secondary" type="button">Reiniciar</button>
  </div>
</header>

<main class="container">
  <section class="card">

    <div class="tableWrap">
      <table id="tbl">
        <colgroup>
          <col class="c-name">
          <col class="c-num">
          <col class="c-num">
          <col class="c-num">
          <col class="c-num">
          <col class="c-num">
          <col class="c-btn">
        </colgroup>

        <thead>
          <tr>
            <th>Ingrediente</th>
            <th>Costo</th>
            <th>Cantidad</th>
            <th>Costo Unitario</th>
            <th>Receta</th>
            <th>Costo Receta</th>
            <th></th>
          </tr>
        </thead>

        <tbody id="tbody"></tbody>

        <tfoot>
          <tr>
            <td colspan="5" class="totalLabel">Total</td>
            <td class="totalValue" id="totalCell">$0</td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- Pricing / Margin -->
    <div class="pricing">
      <div class="drawerCard">
        <div class="kv">
          <div class="k">Margen Ganancia (%)</div>
          <input id="marginPct" inputmode="decimal" value="30" style="max-width:120px;" />
        </div>
        <div class="smallNote">Precio final redondeado a intero.</div>
      </div>

      <div class="drawerCard">
        <div class="kv">
          <div class="k">Precio Final</div>
          <div class="v" id="finalPriceCell">$0</div>
        </div>
      </div>
    </div>

    <div class="hint">
      On iPhone: Safari → Share → Add to Home Screen.
    </div>

  </section>
</main>

<!-- Cache-bust -->
<script src="app.js?v=20260208d"></script>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./service-worker.js', { updateViaCache: 'none' })
    .then(reg => { try { reg.update(); } catch(e) {} })
    .catch(()=>{});
}
</script>

</body>
</html>
