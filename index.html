<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de Costos</title>

  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#f3dfe4">

  <!-- Cache-bust -->
  <link rel="stylesheet" href="./style.css?v=20260214b" />
</head>
<body>

<!-- Sidebar overlay + drawer -->
<div id="drawerOverlay" class="drawerOverlay" aria-hidden="true"></div>

<aside id="drawer" class="drawer" aria-label="Recipes">
  <div class="drawerHeader">
    <p class="drawerTitle">Recetas</p>
    <button id="closeDrawerBtn" class="iconBtn" type="button" aria-label="Close">✕</button>
  </div>

  
<div class="drawerBody">

  <!-- Search + Favorites filter -->
  <div class="drawerCard">
    <div class="drawerCol">
      <label class="fieldLabel" for="recipeSearch">Buscar</label>
      <input id="recipeSearch" placeholder="Buscar receta…" />
    </div>

    <div style="margin-top:10px;">
      <label class="check">
        <input id="favOnlyToggle" type="checkbox" />
        <span>Solo favoritas</span>
      </label>
    </div>

    <div class="smallNote">
      Tip: escribe para filtrar por nombre.
    </div>
  </div>

  <!-- Create recipe -->
  <div class="drawerCard">
    <div class="drawerRow">
      <input id="newRecipeName" placeholder="Nueva Receta (ej. Kuchen)" />
      <button id="createRecipeBtn" class="btn" type="button">Crear</button>
    </div>
    <div class="smallNote">Tip: Abre una receta, luego presiona <b>Guardar</b> para almacenar ingredientes.</div>
  </div>

  <!-- Current recipe actions + list -->
  <div class="drawerCard">
    <div class="drawerRow" style="justify-content:space-between; gap:10px;">
      <div class="pill">Receta actual</div>
      <div class="rowRight">
        <button id="toggleFavoriteBtn" class="iconBtn" type="button" title="Marcar como favorita">☆</button>
        <button id="saveRecipeBtn" class="btn" type="button">Guardar</button>
      </div>
    </div>

    <div id="recipeList" class="recipeList" role="list" style="margin-top:12px;"></div>
  </div>

</div>
</aside>

<header class="topbar">
  <div class="brand">
    <div class="tabsRow">
      <button id="openDrawerBtn" class="hamburger" type="button" aria-label="Open menu">☰</button>
      <button id="viewSummaryBtn" class="tabBtn" type="button" aria-label="Resumen">Resumen</button>
      <button id="viewEditorBtn" class="tabBtn" type="button" aria-label="Editor">Editor</button>
    </div>

    <div class="titleBlock">
      <h1 id="recipeTitle">Calculadora de Costos</h1>
      <p class="sub">Ingrediente → Costo Unitario → Costo Receta</p>
    </div>
  </div>

  <div class="actions">
    <button id="addRowBtn" class="btn" type="button">+ Añadir</button>
    <button id="resetBtn" class="btn btn-secondary" type="button">Reiniciar</button>
  </div>
</header>

<main class="container">
  
<!-- Summary View -->
<section id="summaryView" class="card" style="display:none;">
  <div class="cardHeader">
    <div>
      <h2 style="margin:0;">Resumen de recetas</h2>
      <p class="muted" style="margin:6px 0 0 0;">Busca, filtra por favoritas y revisa costos rápidamente.</p>
    </div>
    <div class="summaryControls">
      <input id="summarySearch" placeholder="Buscar receta…" />
      <label class="check summaryFav">
        <input id="summaryFavOnly" type="checkbox" />
        <span>Solo favoritas</span>
      </label>
    </div>
  </div>

  <div class="tableWrap">
    <table class="summaryTable">
      <thead>
        <tr>
          <th>Nombre receta</th>
          <th>Costo receta</th>
          <th>Precio final</th>
        </tr>
      </thead>
      <tbody id="summaryTbody"></tbody>
    </table>
  </div>
</section>

<!-- Editor View (existing UI) -->
<section id="editorView" class="card">

    <div class="tableWrap">
      <table id="tbl">
        <colgroup>
          <col class="c-name">
          <col class="c-num">
          <col class="c-num">
          <col class="c-num">
          <col class="c-num">
          <col class="c-num">
          <col class="c-btn">
        </colgroup>

        <thead>
          <tr>
            <th>Ingrediente</th>
            <th>Costo</th>
            <th>Cantidad</th>
            <th>Costo Unitario</th>
            <th>Receta</th>
            <th>Costo Receta</th>
            <th></th>
          </tr>
        </thead>

        <tbody id="tbody"></tbody>

        <tfoot>
          <tr>
            <td colspan="5" class="totalLabel">Total</td>
            <td class="totalValue" id="totalCell">$0</td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- Pricing / Margin -->
    <div class="pricing">
      <div class="drawerCard">
        <div class="kv">
          <div class="k">Margen Ganancia (%)</div>
          <input id="marginPct" inputmode="decimal" value="30" style="max-width:120px;" />
        </div>
        <div class="smallNote">Precio final redondeado a intero.</div>
      </div>

      <div class="drawerCard">
        <div class="kv">
          <div class="k">Precio Final</div>
          <div class="v" id="finalPriceCell">$0</div>
        </div>
      </div>
    </div>

    <div class="hint">
      On iPhone: Safari → Share → Add to Home Screen.
    </div>

  </section>
</main>

<!-- Cache-bust -->
<script src="./app.js?v=20260214b" defer></script>

<script>
/* Guard: if app.js didn't bind events, show a helpful hint */
window.addEventListener('load', () => {
  setTimeout(() => {
    const openBtn = document.getElementById('openDrawerBtn');
    const sumBtn  = document.getElementById('viewSummaryBtn');
    const edBtn   = document.getElementById('viewEditorBtn');

    function attachHint(el){
      if (!el) return;
      // If the element already has listeners from app.js, we do nothing.
      // We can't reliably detect that, so we attach a once handler that only fires if nothing changes.
      el.addEventListener('click', () => {
        const body = document.body;
        const had = body.classList.contains('drawer-open');
        // if after a tick nothing changes, show hint
        setTimeout(() => {
          const now = body.classList.contains('drawer-open');
          if (had === now){
            alert("Parece que app.js no se está cargando (o está cacheado). Verifica que existan ./app.js y ./style.css en el repo y que no tengas service-worker activo.");
          }
        }, 50);
      }, { once: true });
    }

    attachHint(openBtn);
    attachHint(sumBtn);
    attachHint(edBtn);
  }, 200);
});
</script>
</body>
</html>
